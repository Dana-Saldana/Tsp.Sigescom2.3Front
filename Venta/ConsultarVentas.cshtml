@{
    ViewBag.Title = "Consulta de ventas";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section scripts{
    <script src=@Url.Content("~/Scripts/controller/venta/consultarVentasController.js")></script>
    <script src=@Url.Content("~/Scripts/controller/venta/ventaController.js")></script>
    <script src=@Url.Content("~/Scripts/controller/cliente/clienteController.js")></script>
    <script src=@Url.Content("~/Scripts/controller/nota/registradorNota/registradorNota.js")></script>
    <script src=@Url.Content("~/Scripts/controller/finanza/editorPago/editorPago.js")></script>
    <script src=@Url.Content("~/Scripts/controller/finanza/editorTrazaPago/editorTrazaPago.js")></script>
    <script src=@Url.Content("~/Scripts/controller/finanza/registradorFinanciamiento/registradorFinanciamiento.js")></script>

    <script>
        @*var ventasSujetasADisponibilidadStock = @ViewBag.ventasSujetasADisponibilidadStock.ToString().ToLower();*@
        var aplicaLeyAmazonia = @ViewBag.aplicaLeyAmazonia.ToString().ToLower();
        var idComprobanteNotaDeCredito=@ViewBag.idComprobanteNotaDeCredito;
        var idComprobanteNotaDeDebito=@ViewBag.idComprobanteNotaDeDebito;
        var idTipoTransaccionOrdenDeVenta=@ViewBag.idTipoTransaccionOrdenDeVenta;
        var idTipoTransaccionAnulacionOrdenDeVenta=@ViewBag.idTipoTransaccionAnulacionOrdenDeVenta;
        var idTipoTransaccionDescuentoSobreOrdenDeVenta=@ViewBag.idTipoTransaccionDescuentoSobreOrdenDeVenta;
        var idTipoTransaccionDebitoSobreOrdenDeVenta =@ViewBag.idTipoTransaccionDebitoSobreOrdenDeVenta;
        var tasaIGV = @ViewBag.tasaIGV;
        var fechaInicio = '@ViewBag.fechaInicio';
        var fechaFin = '@ViewBag.fechaFin';
        var idDetalleMaestroAnulacionDeLaOperacion = @ViewBag.idDetalleMaestroAnulacionDeLaOperacion;
        var idDetalleMaestroAnulacionPorErrorEnElRuc = @ViewBag.idDetalleMaestroAnulacionPorErrorEnElRuc;
        var idDetalleMaestroCorreccionPorErrorEnLaDescripcion = @ViewBag.idDetalleMaestroCorreccionPorErrorEnLaDescripcion;
        var idDetalleMaestroDescuentoGlobal = @ViewBag.idDetalleMaestroDescuentoGlobal;
        var idDetalleMaestroDescuentoPorItem = @ViewBag.idDetalleMaestroDescuentoPorItem;
        var idDetalleMaestroDevolucionTotal = @ViewBag.idDetalleMaestroDevolucionTotal;
        var idDetalleMaestroDevolucionPorItem = @ViewBag.idDetalleMaestroDevolucionPorItem;
        var idDetalleMaestroBonificacion = @ViewBag.idDetalleMaestroBonificacion;
        var idDetalleMaestroDisminucionEnElValor = @ViewBag.idDetalleMaestroDisminucionEnElValor;
        var idDetalleMaestroOtrosConceptos = @ViewBag.idDetalleMaestroOtrosConceptos;
        var idDetalleMaestroInteresesPorMora = @ViewBag.idDetalleMaestroInteresesPorMora;
        var idDetalleMaestroAumentoEnElValor = @ViewBag.idDetalleMaestroAumentoEnElValor;
        var idDetalleMaestroPenalidadesYOtrosConceptos = @ViewBag.idDetalleMaestroPenalidadesYOtrosConceptos;
        var permitirCanjeDeComprobante = @ViewBag.permitirCanjeDeComprobanteEnVentas.ToString().ToLower();
        var idTipoComprobanteNotaDeVenta = @ViewBag.idTipoComprobanteNotaDeVenta;
        var idTipoComprobanteFactura = @ViewBag.idTipoComprobanteFactura;
        var idTipoDocumentoIdentidadRuc = @ViewBag.idTipoDocumentoIdentidadRuc;
        var numeroDecimalesEnCantidad = @ViewBag.numeroDecimalesEnCantidad;
        var numeroDecimalesEnPrecio = @ViewBag.numeroDecimalesEnPrecio;
        var permitirClonarVenta = @ViewBag.permitirClonarVenta.ToString().ToLower();
        var idRolCliente = @ViewBag.idRolCliente;
        var tiempoEsperaBusquedaSelector = @ViewBag.tiempoEsperaBusquedaSelector;
        var minimoCaracteresBuscarActorComercial = @ViewBag.minimoCaracteresBuscarActorComercial;
        var mostrarSelectorClienteEnVerVentas = @ViewBag.mostrarSelectorClienteEnVerVentas.ToString().ToLower();
        var mostrarBuscadorComprobanteEnVerVentas = @ViewBag.mostrarBuscadorComprobanteEnVerVentas.ToString().ToLower();
        var permitirVentaAlCredito = @ViewBag.permitirVentaAlCredito.ToString().ToLower();
        var idMedioDePagoEfectivo = @ViewBag.IdMedioDePagoEfectivo;
        var permitirEnvioPorWhatsApp = @ViewBag.PermitirEnvioPorWhatsApp.ToString().ToLower();
        var envioComprobantePostVenta = @ViewBag.EnvioComprobantePostVenta.ToString().ToLower();

    </script>
    @* Register the WebClientPrint script code generated by DemoPrintFileController. *@
    @Html.Raw(ViewBag.WCPScript);
}

<div class="col-md-12" ng-controller="consultarVentasController" ng-init="inicializarBandejaDeVentas()">
    <div class="row">
        <div class="col-md-12" style="margin-bottom: -8px;">
            <div class="color-palette-set">
                <div class="bg-green color-palette">CONSULTA DE VENTAS</div>
            </div>
        </div>
        <div class="col-md-12 form-horizontal">
            <div class="row">
                <div class="col-md-10 p-0">
                    <div class="col-md-12 col-xs-12 col-md-12" ng-if="mostrarBuscadorComprobanteEnVerVentas">
                        <label class="box-title">FILTROS :&nbsp;&nbsp;&nbsp;&nbsp;</label>
                        <div class="radio radio-primary radio-inline pt-2">
                            <input type="radio" id="radioVentas1" name="filtro" ng-model="busqueda.FiltroFecha" value="true">
                            <label for="radioVentas1" title="Buscar por fecha" style="font-size:14px;">Fecha {{mostrarSelectorClienteEnVerVentas ? ' y Cliente' : ''}}</label>
                        </div>
                        <div class="radio radio-primary radio-inline pt-2">
                            <input type="radio" id="radioVentas2" name="filtro" ng-model="busqueda.FiltroFecha" value="false">
                            <label for="radioVentas2" title="Buscar por comprobante" style="font-size:14px;">Comprobante</label>
                        </div>
                    </div>
                    <div class="col-sx-12 col-sm-12 col-md-5 no-padding" ng-show="busqueda.FiltroFecha == 'true'">
                        <div class="col-sx-12 col-sm-6 col-md-6">
                            <label>Fecha Inicial</label>
                            <div class="input-group date">
                                <div class="input-group-addon">
                                    <i class="fa fa-calendar"></i>
                                </div>
                                <input id="fechaInicio" ng-model="fechaInicio" class="form-control datetimepicker" />
                            </div>
                        </div>
                        <div class="col-sx-12 col-sm-6 col-md-6">
                            <label>Fecha Final</label>
                            <div class="input-group date">
                                <div class="input-group-addon">
                                    <i class="fa fa-calendar"></i>
                                </div>
                                <input id="fechaFin" ng-model="fechaFin" class="form-control datetimepicker" />
                            </div>
                        </div>
                    </div>
                    <div class="col-md-5" ng-show="mostrarSelectorClienteEnVerVentas && (busqueda.FiltroFecha == 'true')">
                        <label>Cliente</label>
                        <div class="input-group" ng-show="busqueda.TieneClienteSeleccionado">
                            <p class="form-control" style="height: 35px;"> {{clienteSeleccionado.RazonSocial}}</p>
                            <span class="input-group-addon"><button type="button" class="close" style="opacity:1" ng-click="limpiarClienteSeleccionado()"><span aria-hidden="true">×</span></button></span>
                        </div>
                        <ui-select ng-model="clienteSeleccionado" ng-change="seleccionarActorComercial(clienteSeleccionado)" theme="bootstrap" close-on-select="false" ng-show="!busqueda.TieneClienteSeleccionado">
                            <ui-select-match placeholder="TODOS">{{$item.RazonSocial}}</ui-select-match>
                            <ui-select-choices refresh="cargarClientesPorBusqueda($select.search)"
                                               minimum-input-length="{{minimoCaracteresBuscarActorComercial}}"
                                               refresh-delay="{{tiempoEsperaBusquedaSelector}}"
                                               repeat="actorComercialBuscado in clientesPorBusqueda | filter:$select.search">
                                {{actorComercialBuscado.RazonSocial}}
                            </ui-select-choices>
                        </ui-select>
                    </div>
                    <div class="col-md-2" ng-show="busqueda.FiltroFecha == 'false'">
                        <label>Comprobante</label>
                        <input ng-model="comprobanteIngresado" uppercase-only class="form-control" placeholder="B000-0000" />
                    </div>
                    <div class="col-md-2">
                        <button title="CONSULTAR" style="margin-top:25px" class="btn btn-md btn-primary" ng-click="listarBandeja()"><span class="glyphicon glyphicon-search"></span></button>
                        <button title="DESCARGAR" style="margin-top:25px" ng-click="export('tabla-ventas')" class="btn btn-md btn-primary"><span class="fa fa-file-excel-o"></span></button>
                    </div>
                </div>
                <div class="col-md-2" ng-if="permitirCanjeDeComprobante" style="border-left:solid 1px var(--color-primario)">
                    <label class="box-title">CANJEAR COMPROBANTE</label>
                    <div class="checkbox checkbox-primary" style="padding-top:0px">
                        <input id="canjeComprobante" type="checkbox" class="styled" ng-model="canjeDeComprobanteActivado" ng-change="accionCanjeDeComprobante();" />
                        <label for="canjeComprobante" class="negrita">ACTIVAR CANJE</label>
                    </div>
                    <button style="margin-top:5px" ng-click="verificarCanjeDeComprobante()" class="btn btn-md btn-primary pull-right" ng-if="canjeDeComprobanteActivado" ng-disabled="comprobantesSeleccionados.length == 0">CANJEAR</button>
                </div>
            </div>
        </div>
        <div class="col-md-12 table-responsive" style="margin-top:15px">
            <table id="tabla-ventas" datatable="ng" dt-options="dtOptions" dt-column-defs="ventas.dtColumnDefs" class="row-border hover table table-stripped table-bordered">
                <thead>
                    <tr>
                        <th ng-if="permitirCanjeDeComprobante"></th>
                        <th>N°</th>
                        <th>Fecha</th>
                        <th>Tipo Doc.</th>
                        <th>Documento</th>
                        <th>Cliente</th>
                        <th>Vendedor</th>
                        <th>Total</th>
                        <th>Tipo De Venta</th>
                        <th>Modo De Pago</th>
                        <th>Estado</th>
                        <th>Transmitido</th>
                        <th>Opciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="item in ventas" ng-cloak>
                        <td ng-if="permitirCanjeDeComprobante">
                            <div ng-show="item.PuedeCanjearse && canjeDeComprobanteActivado">
                                <input type="checkbox" data-checklist-model="comprobantesSeleccionados" data-checklist-value="item" style="height:13px !important">
                            </div>
                        </td>
                        <td>{{$index+1}}</td>
                        <td>{{item.Fecha}}</td>
                        <td title="{{item.TipoComprobante}}">{{item.CodigoComprobante}}</td>
                        <td>{{item.Comprobante}}</td>
                        <td>{{item.Cliente}}</td>
                        <td>{{item.Cajero}}</td>
                        <td class="numero-derecha">{{"S/. "+item.Total}}</td>
                        <td>{{item.TipoDeVenta}}</td>
                        <td>{{item.ModoDePago}}</td>
                        <td>{{item.Estado}}</td>
                        <td>{{item.EstaTransmitido}}</td>
                        <td>
                            <a title="Ver Documento" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#modal-ver-venta" ng-click="inicializarVerDeDocumento(item);"><span class="glyphicon glyphicon-search"></span></a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    @Html.Partial("_ModalVerDocumento")
    @Html.Partial("_ModalCanjeDeComprobante")
    @*<div ng-controller="ventaController">

            <div id="modal-registro" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                 aria-hidden="true" data-backdrop="static">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title">REGISTRAR VENTA</h4>
                        </div>
                        <div class="modal-body">
                            @Html.Partial("_RegistroVentaPartial")
                        </div>
                        <div class="modal-footer">
                            <button title="GUARDAR VENTA" class="btn btn-info btn-sm" ng-disabled="venta.MontoRecibido<venta.Total || (venta.Detalles.length<1)" ng-click="guardarEnModal()"><span class="glyphicon glyphicon-floppy-save"></span> GUARDAR VENTA</button>
                            <button title="Cerrar" ng-click="close()" class="btn btn-sm btn-danger"><span class="glyphicon glyphicon-remove"></span> CERRAR</button>
                        </div>
                    </div>
                </div>
            </div>
            @Html.Partial("_ModalAnularVenta")
            @Html.Partial("_ModalVerVenta")
            @Html.Partial("../Genericos/_ModalAdvertenciaPartial")
        </div>*@
</div>
