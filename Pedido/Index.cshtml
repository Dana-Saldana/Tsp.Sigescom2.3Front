@{
    ViewBag.Title = "Bandeja de Pedidos";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section scripts{
    <script src=@Url.Content("~/Scripts/controller/pedido/pedidoController.js")></script>
    <script src=@Url.Content("~/Scripts/controller/venta/registradorDetalles/registradorDetalles.js")></script>
    <script src=@Url.Content("~/Scripts/controller/concepto/registradorConceptoServicio/registradorConceptoServicio.js")></script>
    <script src=@Url.Content("~/Scripts/controller/concepto/selectorConceptoComercial/selectorConceptoComercial.js")></script>
    <script src=@Url.Content("~/Scripts/controller/almacen/registradorGuiaRemision/registradorGuiaRemision.js")></script>
    <script src=@Url.Content("~/Scripts/controller/venta/facturacionVenta/facturacionVenta.js")></script>
    <script src=@Url.Content("~/Scripts/controller/venta/datosFacturacion/datosFacturacion.js")></script>
    <script src=@Url.Content("~/Scripts/controller/finanza/editorPago/editorPago.js")></script>
    <script src=@Url.Content("~/Scripts/controller/finanza/editorTrazaPago/editorTrazaPago.js")></script>
    <script src=@Url.Content("~/Scripts/controller/finanza/registradorFinanciamiento/registradorFinanciamiento.js")></script>
    <script src=@Url.Content("~/Scripts/controller/comprobante/selector/selectorComprobante.js")></script>
    <script src=@Url.Content("~/Scripts/controller/actorComercial/selectorActorComercial/selectorActorComercial.js")></script>
    <script src=@Url.Content("~/Scripts/controller/actorComercial/registradorActorComercial/registradorActorComercial.js")></script>

    <script>
        var data =@(Html.Raw(Json.Encode(ViewBag.Data)));
        var tasaIGV = @ViewBag.TasaIGV;
        var aplicaLeyAmazonia = @ViewBag.AplicaLeyAmazonia.ToString().ToLower();
        var mostrarCodigoBarraBalanza = @ViewBag.MostrarCodigoBarraBalanza.ToString().ToLower();
        var cursorInicialEnCodigoBarra = @ViewBag.CursorInicialEnCodigoBarra.ToString().ToLower();
        var esVentaPorContingencia = @ViewBag.EsVentaPorContingencia.ToString().ToLower();
        var esVentaModoCajaAlmacen = @ViewBag.EsVentaModoCajaAlmacen.ToString().ToLower();
        var permitirRegistroDeGuiasDeRemision = @ViewBag.PermitirRegistroDeGuiasDeRemision.ToString().ToLower();
        var permitirRegistroConceptoServicio = @ViewBag.PermitirRegistroConceptoServicio.ToString().ToLower();
        var permitirRegistroFlete = @ViewBag.PermitirRegistroFlete.ToString().ToLower();
        var permitirRegistroPlaca = @ViewBag.PermitirRegistroPlaca.ToString().ToLower();
        var idClienteGenerico = @ViewBag.IdClienteGenerico;
        var idMedioDePagoEfectivo = @ViewBag.IdMedioDePagoEfectivo;
        var idTipoDocumentoFactura = @ViewBag.IdTipoDocumentoFactura;
        var idTipoDocumentoPorDefectoParaVenta = @ViewBag.IdTipoDocumentoPorDefectoParaVenta;
        var idTipoDocumentoCuandoClienteEsGenerico = @ViewBag.IdTipoDocumentoCuandoClienteEsGenerico;
        var esPregeneracionPedido = @ViewBag.EsPregeneracionPedido.ToString().ToLower();
        var idOrdenAPregenerar = @ViewBag.IdOrdenAPregenerar;
        var fechaInicio = '@ViewBag.FechaInicio';
        var fechaFin = '@ViewBag.FechaFin';
        var idTipoComprobantePedido = @ViewBag.IdTipoComprobantePedido;
        var idTipoComprobanteEmitirPorDefecto = @ViewBag.idTipoComprobanteEmitirPorDefecto;
        var imprimirPedido = @ViewBag.imprimirPedido.ToString().ToLower();
    </script>

    @* Register the WebClientPrint script code generated by PedidoController. *@
    @Html.Raw(ViewBag.WCPScript);
}

<div class="col-md-12" ng-controller="pedidoController" ng-init="inicializar()">
    <div class="row">
        <div class="col-md-12">
            <div class="color-palette-set">
                <div class="bg-green color-palette">CONSULTA DE PEDIDOS</div>
            </div>
        </div>
        <div class="col-md-12 form-horizontal">
            <div class="row">
                <div class="col-sx-12 col-sm-6 col-md-2">
                    <label>Fecha Inicial</label>
                    <div class="input-group">
                        <div class="input-group-addon">
                            <i class="fa fa-calendar"></i>
                        </div>
                        <input ng-model="fechaInicio" placeholder="dd/mm/aaaa" class="form-control datepicker-start" />
                    </div>
                </div>
                <div class="col-sx-12 col-sm-6 col-md-2 no-padding-left">
                    <label>Fecha Final</label>
                    <div class="input-group">
                        <div class="input-group-addon">
                            <i class="fa fa-calendar"></i>
                        </div>
                        <input ng-model="fechaFin" placeholder="dd/mm/aaaa" class="form-control datepicker-end" />
                    </div>
                </div>
                <div class="col-md-1 no-padding">
                    <button title="CONSULTAR" style="margin-top:25px" class="btn btn-md btn-primary" ng-click="listarPedidos()"><span class="glyphicon glyphicon-search"></span></button>
                    <button title="DESCARGAR" style="margin-top:25px" ng-click="export('tabla-cotizaciones')" class="btn btn-md btn-primary"><span class="fa fa-file-excel-o"></span></button>
                </div>
                <div class="col-md-7">
                    <button title="NUEVO PEDIDO" style="margin-top:25px" class="btn btn-md btn-primary pull-right" data-toggle="modal" data-target="#modal-registro-pedido" ng-click="iniciarNuevoPedido()"><span class="glyphicon glyphicon-plus"></span> NUEVO PEDIDO</button>
                </div>
            </div>
        </div>
        <div class="col-md-12" style="margin-top:10px;">
            <table id="tabla-cotizaciones" datatable="ng" dt-options="dtOptions" dt-column-defs="cotizaciones.dtColumnDefs" class="row-border hover table table-stripped table-bordered">
                <thead>
                    <tr>
                        <th>N°</th>
                        <th>Fecha</th>
                        <th>Tipo Doc.</th>
                        <th>Comprobante</th>
                        <th>Cliente</th>
                        <th>Vendedor</th>
                        <th>Total</th>
                        <th>Estado</th>
                        <th>Opciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="item in pedidos" ng-cloak>
                        <td ng-class="!item.EstaInvalidado ? '' : 'tachado'">{{$index+1}}</td>
                        <td ng-class="!item.EstaInvalidado ? '' : 'tachado'">{{item.FechaEmision}}</td>
                        <td ng-class="!item.EstaInvalidado ? '' : 'tachado'">{{item.TipoComprobante}}</td>
                        <td ng-class="!item.EstaInvalidado ? '' : 'tachado'">{{item.Comprobante}}</td>
                        <td ng-class="!item.EstaInvalidado ? '' : 'tachado'">{{item.Cliente}}</td>
                        <td ng-class="!item.EstaInvalidado ? '' : 'tachado'">{{item.Vendedor}}</td>
                        <td ng-class="!item.EstaInvalidado ? '' : 'tachado'" class="numero-derecha">S/. {{item.Total | number:2}}</td>
                        <td>{{item.Estado}}</td>
                        <td>
                            <a title="Editar pedido" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#modal-registro-pedido" ng-click="iniciarEditarPedido(item)" ng-if="data.TieneRolVendedorDeNegocio && !item.EstaInvalidado "><span class="glyphicon glyphicon-pencil"></span></a>
                            <a title="Invalidar pedido" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#modal-invalidar-pedido" ng-if="data.TieneRolVendedorDeNegocio && !item.EstaInvalidado" ng-click="iniciarInvalidarPedido(item)"><span class="glyphicon glyphicon-remove"></span></a>
                            <a title="Confirmar pedido" class="btn btn-primary btn-xs" ng-if="data.TieneRolCajeroDeNegocio && !item.EstaInvalidado" data-toggle="modal" data-target="#modal-confirmar-pedido" ng-click="iniciarConfirmarPedido(item.Id)"><span class="glyphicon glyphicon-ok"></span></a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    @Html.Partial("_ModalRegistroPedido")
    @Html.Partial("_ModalInvalidarPedido")
    @Html.Partial("_ModalConfirmarPedido")
    @Html.Partial("../Venta/_ModalRegistroConceptoServicio")
</div>
